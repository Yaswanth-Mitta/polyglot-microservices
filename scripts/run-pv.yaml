#!/bin/bash

echo "Deleting StatefulSets and Services..."
kubectl delete statefulset notes-db user-db todo-db
kubectl delete svc notes-db user-db todo-db

# Wait for the PVCs to be automatically deleted by the StatefulSet
echo "Waiting for StatefulSet PVCs to be deleted..."
sleep 10s

# Verify that the PVs have been released and are not bound
echo "Checking PV status..."
kubectl get pv

# Force delete any remaining PVCs if necessary (this is a safeguard)
# kubectl get pvc | grep mongo-storage | xargs kubectl delete pvc

echo "Deleting PersistentVolumes..."
kubectl delete pv notes-pv user-pv todo-pv

echo "All specified resources have been queued for deletion."
